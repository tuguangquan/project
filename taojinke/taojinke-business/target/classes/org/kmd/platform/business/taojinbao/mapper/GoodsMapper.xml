<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.kmd.platform.business.taojinbao.mapper.GoodsMapper">
    <sql id="goods_fields">
		id,uniacid,displayorder,status,istmall,cate_id,itemid,title,d_title,wenan,itempic,shoptitle,itemfee,itemfee2,itemmsell,itemstatus,stime,etime,itemsdsr,itemsurl,itemurl,itemtkl,itemyhj_sid,itemyhj_id,itemyhj_fee,itemyhj_zl,itemyhj_yl,itemyhj_re,itemyhj_tit,itemyhj_stime,itemyhj_etime,itemyhj_url,itemyhj_tkl,link_jihua,com_jihua,com_queqiao,atime,hit,share,fav,quan_link,isdx,fm,shouru_bili,shouru_yongjin,quan_id,maijia_id,tktype,istop,isms,msnum,iszh,iswxqf,islive,islivetj,isvideo,videourl,livetime,isyz
	</sql>

    <resultMap id="goodsResultMap" type="Goods">
        <id property="id" column="id"/>
        <result property="uniacid" column="uniacid"/>
        <result property="displayorder" column="displayorder"/>
        <result property="status" column="status"/>
        <result property="istmall" column="istmall"/>
        <result property="cate_id" column="cate_id"/>
        <result property="itemid" column="itemid"/>
        <result property="title" column="title"/>
        <result property="d_title" column="d_title"/>
        <result property="wenan" column="wenan"/>
        <result property="itempic" column="itempic"/>
        <result property="shoptitle" column="shoptitle"/>
        <result property="itemfee" column="itemfee"/>
        <result property="itemfee2" column="itemfee2"/>
        <result property="itemmsell" column="itemmsell"/>
        <result property="itemstatus" column="itemstatus"/>
        <result property="stime" column="stime"/>
        <result property="etime" column="etime"/>
        <result property="itemsdsr" column="itemsdsr"/>
        <result property="itemsurl" column="itemsurl"/>
        <result property="itemurl" column="itemurl"/>
        <result property="itemtkl" column="itemtkl"/>
        <result property="itemyhj_sid" column="itemyhj_sid"/>
        <result property="itemyhj_id" column="itemyhj_id"/>
        <result property="itemyhj_fee" column="itemyhj_fee"/>
        <result property="itemyhj_zl" column="itemyhj_zl"/>
        <result property="itemyhj_yl" column="itemyhj_yl"/>
        <result property="itemyhj_re" column="itemyhj_re"/>
        <result property="itemyhj_tit" column="itemyhj_tit"/>
        <result property="itemyhj_stime" column="itemyhj_stime"/>
        <result property="itemyhj_etime" column="itemyhj_etime"/>
        <result property="itemyhj_url" column="itemyhj_url"/>
        <result property="itemyhj_tkl" column="itemyhj_tkl"/>
        <result property="link_jihua" column="link_jihua"/>
        <result property="com_jihua" column="com_jihua"/>
        <result property="com_queqiao" column="com_queqiao"/>
        <result property="atime" column="atime"/>
        <result property="hit" column="hit"/>
        <result property="share" column="share"/>
        <result property="fav" column="fav"/>
        <result property="quan_link" column="quan_link"/>
        <result property="isdx" column="isdx"/>
        <result property="fm" column="fm"/>
        <result property="shouru_bili" column="shouru_bili"/>
        <result property="shouru_yongjin" column="shouru_yongjin"/>
        <result property="quan_id" column="quan_id"/>
        <result property="maijia_id" column="maijia_id"/>
        <result property="tktype" column="tktype"/>
        <result property="istop" column="istop"/>
        <result property="isms" column="isms"/>
        <result property="msnum" column="msnum"/>
        <result property="iszh" column="iszh"/>
        <result property="iswxqf" column="iswxqf"/>
        <result property="islive" column="islive"/>
        <result property="islivetj" column="islivetj"/>
        <result property="isvideo" column="isvideo"/>
        <result property="videourl" column="videourl"/>
        <result property="livetime" column="livetime"/>
        <result property="isyz" column="isyz"/>
    </resultMap>

    <insert id="add" parameterType="Goods" keyProperty="id"
            useGeneratedKeys="true">
        INSERT INTO
        ims_bsht_tbk_all_item(
        <include refid="goods_fields" />
        )
        VALUES (#{id},#{uniacid},#{displayorder},#{status},#{istmall},#{cate_id},#{itemid},#{title},
        #{d_title},#{wenan},#{itempic},#{shoptitle},#{itemfee},#{itemfee2},#{itemmsell},#{itemstatus},
        #{stime},#{etime},#{itemsdsr},#{itemsurl},#{itemurl},#{itemtkl},#{itemyhj_sid},#{itemyhj_id},
        #{itemyhj_fee},#{itemyhj_zl},#{itemyhj_yl},#{itemyhj_re},#{itemyhj_tit},#{itemyhj_stime},
        #{itemyhj_etime},#{itemyhj_url},#{itemyhj_tkl},#{link_jihua},#{com_jihua},#{com_queqiao},#{atime},
        #{hit},#{share},#{fav},#{quan_link},#{isdx},#{fm},#{shouru_bili},#{shouru_yongjin},#{quan_id},
        #{maijia_id},#{tktype},#{istop},#{isms},#{msnum},#{iszh},#{iswxqf},#{islive},#{islivetj},#{isvideo},
        #{videourl},#{livetime},#{isyz});
        <selectKey resultType="long" keyProperty="id">
            select
            LAST_INSERT_ID() as id
        </selectKey>
    </insert>

    <select id="findByCondition" parameterType="map" resultMap="goodsResultMap">
        SELECT
        <include refid="goods_fields"/>
        FROM ims_bsht_tbk_all_item
        where 1 = 1
        <if test="top_rate!=null">
            AND commission_rate <![CDATA[<=]]> #{top_rate}
        </if>
        <if test="lower_rate!=null">
            AND commission_rate  <![CDATA[>=]]> #{lower_rate}
        </if>
        <if test="top_price!=null">
            AND goods_price <![CDATA[<=]]> #{top_price}
        </if>
        <if test="lower_price!=null">
              AND goods_price <![CDATA[>=]]> #{lower_price}
         </if>
         <if test="cate_id!=null">
             AND cate_id=#{cate_id}
         </if>
         <if test="goods_name!=null">
             AND goods_name like CONCAT('%',#{goods_name},'%')
         </if>
        limit  #{index},#{size}
    </select>

    <select id="getByCategoryId" parameterType="java.lang.Integer" resultMap="goodsResultMap">
        SELECT
        <include refid="goods_fields"/>
        FROM ims_bsht_tbk_all_item WHERE cate_id=#{categoryId}
    </select>

    <select id="getLastGoods"  parameterType="map"  resultMap="goodsResultMap">
        SELECT
        <include refid="goods_fields"/>
        FROM ims_bsht_tbk_all_item order by id desc limit #{index},#{size}
    </select>

</mapper>